<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Tue Prenotazioni - Lombino Travel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- Sistema di prenotazione Lombino Travel -->
    <script src="booking-system.js"></script>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-8">
                    <a href="index.html" class="text-2xl font-bold text-blue-600">üåç Lombino Travel</a>
                    <nav class="hidden md:flex items-center gap-6 text-gray-700 text-sm">
                        <a href="treni.html" class="hover:text-blue-600">Treni</a>
                        <a href="autobus.html" class="hover:text-blue-600">Autobus</a>
                        <a href="voli.html" class="hover:text-blue-600">Voli</a>
                        <a href="traghetti.html" class="hover:text-blue-600">Traghetti</a>
                    </nav>
                </div>
                <div class="flex items-center gap-4">
                    <button class="text-gray-700 hover:text-blue-600 text-sm">üáÆüáπ Italiano</button>
                    <button class="text-blue-600 font-semibold text-sm">Le tue prenotazioni</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <section class="py-16">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-gray-900 mb-8">Le Tue Prenotazioni</h1>
                
                <!-- Form ricerca prenotazioni -->
                <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                    <h2 class="text-xl font-semibold mb-4">Cerca le tue prenotazioni</h2>
                    <form id="searchBookingsForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email utilizzata per la prenotazione</label>
                            <input type="email" id="userEmail" name="email" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="tua@email.com">
                        </div>
                        <div class="flex items-end">
                            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md font-semibold transition-colors">
                                üîç Cerca Prenotazioni
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Risultati prenotazioni -->
                <div id="bookingsResults" class="space-y-4">
                    <!-- Le prenotazioni verranno mostrate qui -->
                </div>

                <!-- Messaggio vuoto -->
                <div id="emptyMessage" class="text-center py-12 hidden">
                    <div class="text-6xl mb-4">üìã</div>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">Nessuna prenotazione trovata</h3>
                    <p class="text-gray-600 mb-6">Inserisci l'email utilizzata per le prenotazioni o effettua una nuova prenotazione.</p>
                    <a href="index.html" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md font-semibold transition-colors">
                        Prenota Ora
                    </a>
                </div>

                <!-- Statistiche prenotazioni (se presenti) -->
                <div id="bookingStats" class="hidden mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white rounded-lg p-6 text-center shadow-md">
                        <div class="text-3xl font-bold text-blue-600" id="totalBookings">0</div>
                        <div class="text-gray-600">Prenotazioni Totali</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 text-center shadow-md">
                        <div class="text-3xl font-bold text-green-600" id="confirmedBookings">0</div>
                        <div class="text-gray-600">Confermate</div>
                    </div>
                    <div class="bg-white rounded-lg p-6 text-center shadow-md">
                        <div class="text-3xl font-bold text-orange-600" id="totalSpent">‚Ç¨0</div>
                        <div class="text-gray-600">Speso Totale</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <a href="index.html" class="text-xl font-bold mb-4 block">üåç Lombino Travel</a>
                <p class="text-gray-400">¬© 2024 Lombino Travel. Tutti i diritti riservati.</p>
            </div>
        </div>
    </footer>

    <script>
        // Carica prenotazioni al caricamento della pagina
        document.addEventListener('DOMContentLoaded', function() {
            // Se c'√® un email salvata, caricala automaticamente
            const savedEmail = localStorage.getItem('lombino_user_email');
            if (savedEmail) {
                document.getElementById('userEmail').value = savedEmail;
                loadUserBookings(savedEmail);
            }
        });

        // Form di ricerca prenotazioni
        document.getElementById('searchBookingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('userEmail').value;
            localStorage.setItem('lombino_user_email', email);
            loadUserBookings(email);
        });

        // Carica prenotazioni utente
        function loadUserBookings(email) {
            const bookings = window.LombinoBooking.getUserBookings(email);
            const resultsContainer = document.getElementById('bookingsResults');
            const emptyMessage = document.getElementById('emptyMessage');
            const statsContainer = document.getElementById('bookingStats');

            if (bookings.length === 0) {
                resultsContainer.innerHTML = '';
                emptyMessage.classList.remove('hidden');
                statsContainer.classList.add('hidden');
                return;
            }

            // Nascondi messaggio vuoto e mostra statistiche
            emptyMessage.classList.add('hidden');
            statsContainer.classList.remove('hidden');

            // Aggiorna statistiche
            updateBookingStats(bookings);

            // Mostra prenotazioni
            resultsContainer.innerHTML = '';
            bookings.forEach(booking => {
                const bookingCard = createBookingCard(booking);
                resultsContainer.appendChild(bookingCard);
            });
        }

        // Crea card prenotazione
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg shadow-md p-6';
            
            const statusColor = booking.status === 'confirmed' ? 'green' : 
                               booking.status === 'pending' ? 'yellow' : 'red';
            
            const typeIcon = booking.type === 'train' ? 'üöÑ' :
                            booking.type === 'flight' ? '‚úàÔ∏è' :
                            booking.type === 'bus' ? 'üöå' :
                            booking.type === 'ferry' ? '‚õ¥Ô∏è' : 'üé´';

            card.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <div class="text-3xl">${typeIcon}</div>
                        <div>
                            <h3 class="text-lg font-semibold">${booking.departure} ‚Üí ${booking.arrival}</h3>
                            <p class="text-gray-600">${booking.service || booking.airline || booking.company || 'Servizio'}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="bg-${statusColor}-100 text-${statusColor}-800 px-3 py-1 rounded-full text-sm font-semibold">
                            ${booking.status === 'confirmed' ? 'Confermata' : 
                              booking.status === 'pending' ? 'In Attesa' : 'Annullata'}
                        </span>
                        ${booking.confirmationCode ? `<p class="text-sm text-gray-600 mt-1">Codice: ${booking.confirmationCode}</p>` : ''}
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div>
                        <p class="text-sm text-gray-600">Data</p>
                        <p class="font-semibold">${new Date(booking.date).toLocaleDateString('it-IT')}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Orario</p>
                        <p class="font-semibold">${booking.departureTime || 'N/A'} - ${booking.arrivalTime || 'N/A'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Passeggeri</p>
                        <p class="font-semibold">${booking.passengers || 1}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Prezzo</p>
                        <p class="font-semibold text-green-600">‚Ç¨${booking.price}</p>
                    </div>
                </div>

                ${booking.firstName ? `
                <div class="border-t pt-4">
                    <p class="text-sm text-gray-600">Passeggero: <span class="font-semibold">${booking.firstName} ${booking.lastName}</span></p>
                    <p class="text-sm text-gray-600">Email: <span class="font-semibold">${booking.email}</span></p>
                    ${booking.phone ? `<p class="text-sm text-gray-600">Telefono: <span class="font-semibold">${booking.phone}</span></p>` : ''}
                </div>
                ` : ''}

                <div class="flex gap-3 mt-4">
                    ${booking.status === 'confirmed' ? `
                        <button onclick="downloadTicket('${booking.id}')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-md font-semibold transition-colors">
                            üìÑ Scarica Biglietto
                        </button>
                    ` : ''}
                    <button onclick="viewBookingDetails('${booking.id}')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-md font-semibold transition-colors">
                        üëÅÔ∏è Dettagli
                    </button>
                    ${booking.status === 'confirmed' && new Date(booking.date) > new Date() ? `
                        <button onclick="cancelBooking('${booking.id}')" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-md font-semibold transition-colors">
                            ‚ùå Annulla
                        </button>
                    ` : ''}
                </div>
            `;

            return card;
        }

        // Aggiorna statistiche
        function updateBookingStats(bookings) {
            const totalBookings = bookings.length;
            const confirmedBookings = bookings.filter(b => b.status === 'confirmed').length;
            const totalSpent = bookings.reduce((sum, b) => sum + (b.price || 0), 0);

            document.getElementById('totalBookings').textContent = totalBookings;
            document.getElementById('confirmedBookings').textContent = confirmedBookings;
            document.getElementById('totalSpent').textContent = `‚Ç¨${totalSpent}`;
        }

        // Scarica biglietto
        function downloadTicket(bookingId) {
            const booking = window.LombinoBooking.bookings.find(b => b.id === bookingId);
            if (!booking) return;

            // Simula download PDF
            const ticketContent = `
LOMBINO TRAVEL - BIGLIETTO ELETTRONICO
=====================================

Codice Prenotazione: ${booking.confirmationCode}
Tipo: ${booking.type.toUpperCase()}
Servizio: ${booking.service || booking.airline || booking.company}

VIAGGIO:
${booking.departure} ‚Üí ${booking.arrival}
Data: ${new Date(booking.date).toLocaleDateString('it-IT')}
Orario: ${booking.departureTime} - ${booking.arrivalTime}

PASSEGGERO:
${booking.firstName} ${booking.lastName}
Email: ${booking.email}
Telefono: ${booking.phone || 'N/A'}

Prezzo: ‚Ç¨${booking.price}
Stato: ${booking.status}

Grazie per aver scelto Lombino Travel!
            `;

            const blob = new Blob([ticketContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `biglietto-${booking.confirmationCode}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Mostra dettagli prenotazione
        function viewBookingDetails(bookingId) {
            const booking = window.LombinoBooking.bookings.find(b => b.id === bookingId);
            if (!booking) return;

            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <h3 class="text-2xl font-bold mb-6">Dettagli Prenotazione</h3>
                    <pre class="bg-gray-100 p-4 rounded text-sm overflow-x-auto">${JSON.stringify(booking, null, 2)}</pre>
                    <button onclick="this.closest('.fixed').remove()" class="w-full mt-6 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        Chiudi
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Annulla prenotazione
        function cancelBooking(bookingId) {
            if (confirm('Sei sicuro di voler annullare questa prenotazione?')) {
                const booking = window.LombinoBooking.bookings.find(b => b.id === bookingId);
                if (booking) {
                    booking.status = 'cancelled';
                    window.LombinoBooking.saveBookings();
                    
                    // Ricarica prenotazioni
                    const email = document.getElementById('userEmail').value;
                    loadUserBookings(email);
                    
                    alert('Prenotazione annullata con successo.');
                }
            }
        }
    </script>
</body>
</html>
